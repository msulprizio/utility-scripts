#!/bin/bash

# This script fixes the latidue and longitude dimensions in nested grid netCDF
# output files from GEOS-Chem. Lattitude and longitude values are hardcoded
# for the 0.5x0.625 Asia grid (mps, 11/29/18)

module load nco

for file in *.nc4; do

    echo $file

    # Fix latitude dimension
    ncap2 -O -h -s 'lat[lat]={-11, -10.5, -10, -9.5, -9, -8.5, -8, -7.5, -7, -6.5, -6, -5.5, -5, -4.5, -4, -3.5, -3, -2.5, -2, -1.5, -1, -0.5, 0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10, 10.5, 11, 11.5, 12, 12.5, 13, 13.5, 14, 14.5, 15, 15.5, 16, 16.5, 17, 17.5, 18, 18.5, 19, 19.5, 20, 20.5, 21, 21.5, 22, 22.5, 23, 23.5, 24, 24.5, 25, 25.5, 26, 26.5, 27, 27.5, 28, 28.5, 29, 29.5, 30, 30.5, 31, 31.5, 32, 32.5, 33, 33.5, 34, 34.5, 35, 35.5, 36, 36.5, 37, 37.5, 38, 38.5, 39, 39.5, 40, 40.5, 41, 41.5, 42, 42.5, 43, 43.5, 44, 44.5, 45, 45.5, 46, 46.5, 47, 47.5, 48, 48.5, 49, 49.5, 50, 50.5, 51, 51.5, 52, 52.5, 53, 53.5, 54, 54.5, 55};lat@long_name="Latitude";lat@units="degrees_north"' $file tmp.nc

    # Fix longitude dimension
    ncap2 -O -h -s 'lon[lon]={60, 60.625, 61.25, 61.875, 62.5, 63.125, 63.75, 64.375, 65, 65.625, 66.25, 66.875, 67.5, 68.125, 68.75, 69.375, 70, 70.625, 71.25, 71.875, 72.5, 73.125, 73.75, 74.375, 75, 75.625, 76.25, 76.875, 77.5, 78.125, 78.75, 79.375, 80, 80.625, 81.25, 81.875, 82.5, 83.125, 83.75, 84.375, 85, 85.625, 86.25, 86.875, 87.5, 88.125, 88.75, 89.375, 90, 90.625, 91.25, 91.875, 92.5, 93.125, 93.75, 94.375, 95, 95.625, 96.25, 96.875, 97.5, 98.125, 98.75, 99.375, 100, 100.625, 101.25, 101.875, 102.5, 103.125, 103.75, 104.375, 105, 105.625, 106.25, 106.875, 107.5, 108.125, 108.75, 109.375, 110, 110.625, 111.25, 111.875, 112.5, 113.125, 113.75, 114.375, 115, 115.625, 116.25, 116.875, 117.5, 118.125, 118.75, 119.375, 120, 120.625, 121.25, 121.875, 122.5, 123.125, 123.75, 124.375, 125, 125.625, 126.25, 126.875, 127.5, 128.125, 128.75, 129.375, 130, 130.625, 131.25, 131.875, 132.5, 133.125, 133.75, 134.375, 135, 135.625, 136.25, 136.875, 137.5, 138.125, 138.75, 139.375, 140, 140.625, 141.25, 141.875, 142.5, 143.125, 143.75, 144.375, 145, 145.625, 146.25, 146.875, 147.5, 148.125, 148.75, 149.375, 150};lon@long_name="Longitude";lon@units="degrees_east"' tmp.nc $file

    # Remove temporary file
    rm -f tmp.nc

done

exit 0
